<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Ù…ÙˆÙ„Ø¯ Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ - Profile Suite</title>
  <style>
    :root {
      --bg-primary: #0a0a0f;
      --bg-secondary: #12121a;
      --bg-card: #16161f;
      --bg-input: #1a1a24;
      --border: #2a2a3a;
      --primary: #6366f1;
      --primary-glow: #818cf8;
      --success: #22c55e;
      --warning: #f59e0b;
      --danger: #ef4444;
      --text: #ffffff;
      --text-muted: #9ca3af;
      --radius: 12px;
    }

    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
    }

    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--bg-primary);
      color: var(--text);
      min-height: 100vh;
      line-height: 1.6;
    }

    .container {
      max-width: 1200px;
      margin: 0 auto;
      padding: 2rem;
    }

    /* Header */
    .header {
      text-align: center;
      margin-bottom: 3rem;
      padding: 2rem;
      background: linear-gradient(135deg, var(--bg-card), var(--bg-secondary));
      border-radius: var(--radius);
      border: 1px solid var(--border);
      position: relative;
      overflow: hidden;
    }

    .header::before {
      content: '';
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      height: 3px;
      background: linear-gradient(90deg, var(--primary), var(--primary-glow), var(--primary));
    }

    .header h1 {
      font-size: 2rem;
      margin-bottom: 0.5rem;
      background: linear-gradient(135deg, var(--text), var(--primary-glow));
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }

    .header p {
      color: var(--text-muted);
    }

    /* Grid Layout */
    .grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 2rem;
    }

    @media (max-width: 900px) {
      .grid {
        grid-template-columns: 1fr;
      }
    }

    /* Card */
    .card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.5rem;
    }

    .card-title {
      font-size: 1.25rem;
      margin-bottom: 1.5rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .card-title svg {
      width: 24px;
      height: 24px;
      color: var(--primary);
    }

    /* Form Elements */
    .form-group {
      margin-bottom: 1.25rem;
    }

    label {
      display: block;
      margin-bottom: 0.5rem;
      font-weight: 500;
      color: var(--text);
    }

    input, select, textarea {
      width: 100%;
      padding: 0.75rem 1rem;
      background: var(--bg-input);
      border: 1px solid var(--border);
      border-radius: 8px;
      color: var(--text);
      font-size: 1rem;
      transition: all 0.2s;
    }

    input:focus, select:focus, textarea:focus {
      outline: none;
      border-color: var(--primary);
      box-shadow: 0 0 0 3px rgba(99, 102, 241, 0.2);
    }

    select {
      cursor: pointer;
    }

    /* Buttons */
    .btn {
      padding: 0.75rem 1.5rem;
      border: none;
      border-radius: 8px;
      font-size: 1rem;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.2s;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.5rem;
    }

    .btn-primary {
      background: linear-gradient(135deg, var(--primary), var(--primary-glow));
      color: white;
      box-shadow: 0 4px 15px rgba(99, 102, 241, 0.4);
    }

    .btn-primary:hover {
      transform: translateY(-2px);
      box-shadow: 0 6px 20px rgba(99, 102, 241, 0.5);
    }

    .btn-secondary {
      background: var(--bg-input);
      color: var(--text);
      border: 1px solid var(--border);
    }

    .btn-secondary:hover {
      background: var(--border);
    }

    .btn-danger {
      background: var(--danger);
      color: white;
    }

    .btn-danger:hover {
      opacity: 0.9;
    }

    .btn-full {
      width: 100%;
    }

    /* License Result */
    .license-result {
      background: var(--bg-secondary);
      border: 2px solid var(--success);
      border-radius: var(--radius);
      padding: 1.5rem;
      margin-top: 1.5rem;
      display: none;
    }

    .license-result.show {
      display: block;
      animation: fadeIn 0.3s ease;
    }

    @keyframes fadeIn {
      from { opacity: 0; transform: translateY(-10px); }
      to { opacity: 1; transform: translateY(0); }
    }

    .license-code {
      background: var(--bg-input);
      padding: 1rem;
      border-radius: 8px;
      font-family: monospace;
      font-size: 0.85rem;
      word-break: break-all;
      margin: 1rem 0;
      border: 1px solid var(--border);
      max-height: 120px;
      overflow-y: auto;
    }

    .license-info {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 0.75rem;
      margin-bottom: 1rem;
    }

    .license-info-item {
      background: var(--bg-input);
      padding: 0.75rem;
      border-radius: 8px;
    }

    .license-info-item span:first-child {
      color: var(--text-muted);
      font-size: 0.85rem;
    }

    .license-info-item span:last-child {
      display: block;
      font-weight: 600;
      margin-top: 0.25rem;
    }

    /* Licenses List */
    .licenses-list {
      max-height: 500px;
      overflow-y: auto;
    }

    .license-item {
      background: var(--bg-secondary);
      border: 1px solid var(--border);
      border-radius: 8px;
      padding: 1rem;
      margin-bottom: 0.75rem;
      transition: all 0.2s;
    }

    .license-item:hover {
      border-color: var(--primary);
    }

    .license-item-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 0.5rem;
    }

    .license-item-name {
      font-weight: 600;
      font-size: 1.1rem;
    }

    .license-item-type {
      padding: 0.25rem 0.75rem;
      border-radius: 20px;
      font-size: 0.8rem;
      font-weight: 600;
    }

    .type-trial { background: var(--warning); color: #000; }
    .type-basic { background: #3b82f6; color: #fff; }
    .type-pro { background: var(--primary); color: #fff; }
    .type-enterprise { background: var(--success); color: #fff; }

    .license-item-details {
      color: var(--text-muted);
      font-size: 0.9rem;
      margin-bottom: 0.75rem;
    }

    .license-item-actions {
      display: flex;
      gap: 0.5rem;
    }

    .license-item-actions .btn {
      padding: 0.5rem 1rem;
      font-size: 0.85rem;
    }

    .badge {
      display: inline-block;
      padding: 0.15rem 0.5rem;
      border-radius: 4px;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .badge-active { background: var(--success); color: #fff; }
    .badge-expired { background: var(--danger); color: #fff; }

    /* Stats */
    .stats {
      display: grid;
      grid-template-columns: repeat(4, 1fr);
      gap: 1rem;
      margin-bottom: 2rem;
    }

    @media (max-width: 600px) {
      .stats {
        grid-template-columns: repeat(2, 1fr);
      }
    }

    .stat-card {
      background: var(--bg-card);
      border: 1px solid var(--border);
      border-radius: var(--radius);
      padding: 1.25rem;
      text-align: center;
    }

    .stat-value {
      font-size: 2rem;
      font-weight: 700;
      color: var(--primary);
    }

    .stat-label {
      color: var(--text-muted);
      font-size: 0.9rem;
    }

    /* Empty State */
    .empty-state {
      text-align: center;
      padding: 3rem;
      color: var(--text-muted);
    }

    .empty-state svg {
      width: 64px;
      height: 64px;
      margin-bottom: 1rem;
      opacity: 0.5;
    }

    /* Toast */
    .toast {
      position: fixed;
      bottom: 2rem;
      left: 50%;
      transform: translateX(-50%) translateY(100px);
      background: var(--bg-card);
      border: 1px solid var(--border);
      padding: 1rem 2rem;
      border-radius: var(--radius);
      box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
      transition: transform 0.3s ease;
      z-index: 1000;
    }

    .toast.show {
      transform: translateX(-50%) translateY(0);
    }

    .toast.success { border-color: var(--success); }
    .toast.error { border-color: var(--danger); }

    /* Scrollbar */
    ::-webkit-scrollbar {
      width: 8px;
    }

    ::-webkit-scrollbar-track {
      background: var(--bg-secondary);
    }

    ::-webkit-scrollbar-thumb {
      background: var(--border);
      border-radius: 4px;
    }

    ::-webkit-scrollbar-thumb:hover {
      background: var(--primary);
    }
  </style>
</head>
<body>
  <div class="container">
    <!-- Header -->
    <div class="header">
      <h1>ğŸ” Ù…ÙˆÙ„Ø¯ Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ - Profile Suite</h1>
      <p>Ø£Ù†Ø´Ø¦ ÙˆØ£Ø¯ÙØ± ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ø¹Ù…Ù„Ø§Ø¡ Ø¨Ø³Ù‡ÙˆÙ„Ø©</p>
    </div>

    <!-- Stats -->
    <div class="stats" id="stats">
      <div class="stat-card">
        <div class="stat-value" id="totalLicenses">0</div>
        <div class="stat-label">Ø¥Ø¬Ù…Ø§Ù„ÙŠ Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="activeLicenses">0</div>
        <div class="stat-label">Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„ÙØ¹Ø§Ù„Ø©</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="expiredLicenses">0</div>
        <div class="stat-label">Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ù…Ù†ØªÙ‡ÙŠØ©</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="todayLicenses">0</div>
        <div class="stat-label">ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„ÙŠÙˆÙ…</div>
      </div>
    </div>

    <!-- Main Grid -->
    <div class="grid">
      <!-- Create License Form -->
      <div class="card">
        <h2 class="card-title">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4" />
          </svg>
          Ø¥Ù†Ø´Ø§Ø¡ ØªØ±Ø®ÙŠØµ Ø¬Ø¯ÙŠØ¯
        </h2>

        <form id="licenseForm">
          <div class="form-group">
            <label for="clientName">Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„ *</label>
            <input type="text" id="clientName" required placeholder="Ø£Ø¯Ø®Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„">
          </div>

          <div class="form-group">
            <label for="clientEmail">Ø§Ù„Ø¨Ø±ÙŠØ¯ Ø§Ù„Ø¥Ù„ÙƒØªØ±ÙˆÙ†ÙŠ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ)</label>
            <input type="email" id="clientEmail" placeholder="email@example.com" dir="ltr">
          </div>

          <div class="form-group">
            <label for="licenseType">Ù†ÙˆØ¹ Ø§Ù„ØªØ±Ø®ÙŠØµ</label>
            <select id="licenseType">
              <option value="trial">ØªØ¬Ø±ÙŠØ¨ÙŠ - Trial (7 Ø£ÙŠØ§Ù…ØŒ 5 Ø¨Ø±ÙˆÙØ§ÙŠÙ„Ø§Øª)</option>
              <option value="basic">Ø£Ø³Ø§Ø³ÙŠ - Basic (30 ÙŠÙˆÙ…ØŒ 20 Ø¨Ø±ÙˆÙØ§ÙŠÙ„)</option>
              <option value="pro" selected>Ø§Ø­ØªØ±Ø§ÙÙŠ - Pro (365 ÙŠÙˆÙ…ØŒ 100 Ø¨Ø±ÙˆÙØ§ÙŠÙ„)</option>
              <option value="enterprise">Ù…Ø¤Ø³Ø³ÙŠ - Enterprise (730 ÙŠÙˆÙ…ØŒ 999 Ø¨Ø±ÙˆÙØ§ÙŠÙ„)</option>
            </select>
          </div>

          <div class="form-group">
            <label for="maxProfiles">Ø¹Ø¯Ø¯ Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„Ø§Øª Ø§Ù„Ù…Ø³Ù…ÙˆØ­</label>
            <input type="number" id="maxProfiles" min="1" max="9999" placeholder="Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±Øº Ù„Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ">
          </div>

          <div class="form-group">
            <label for="durationDays">Ù…Ø¯Ø© Ø§Ù„ØªØ±Ø®ÙŠØµ (Ø¨Ø§Ù„Ø£ÙŠØ§Ù…)</label>
            <input type="number" id="durationDays" min="1" max="3650" placeholder="Ø§ØªØ±ÙƒÙ‡ ÙØ§Ø±Øº Ù„Ù„Ø§ÙØªØ±Ø§Ø¶ÙŠ">
          </div>

          <div class="form-group">
            <label for="notes">Ù…Ù„Ø§Ø­Ø¸Ø§Øª</label>
            <textarea id="notes" rows="2" placeholder="Ù…Ù„Ø§Ø­Ø¸Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©..."></textarea>
          </div>

          <button type="submit" class="btn btn-primary btn-full">
            <svg xmlns="http://www.w3.org/2000/svg" width="20" height="20" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z" />
            </svg>
            Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ±Ø®ÙŠØµ
          </button>
        </form>

        <!-- License Result -->
        <div class="license-result" id="licenseResult">
          <h3 style="color: var(--success); margin-bottom: 1rem;">âœ… ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ±Ø®ÙŠØµ Ø¨Ù†Ø¬Ø§Ø­!</h3>
          
          <div class="license-info" id="licenseInfo"></div>
          
          <label>ÙƒÙˆØ¯ Ø§Ù„ØªØ±Ø®ÙŠØµ:</label>
          <div class="license-code" id="licenseCode"></div>
          
          <div style="display: flex; gap: 0.5rem;">
            <button class="btn btn-primary" onclick="copyLicenseCode()" style="flex: 1;">
              ğŸ“‹ Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯
            </button>
            <button class="btn btn-secondary" onclick="resetForm()" style="flex: 1;">
              â• ØªØ±Ø®ÙŠØµ Ø¬Ø¯ÙŠØ¯
            </button>
          </div>
        </div>
      </div>

      <!-- Licenses List -->
      <div class="card">
        <h2 class="card-title">
          <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2" />
          </svg>
          Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ù…ÙÙ†Ø´Ø£Ø©
        </h2>

        <div style="display: flex; gap: 0.5rem; margin-bottom: 1rem;">
          <input type="text" id="searchLicenses" placeholder="ğŸ” Ø§Ù„Ø¨Ø­Ø«..." style="flex: 1;">
          <button class="btn btn-secondary" onclick="exportLicenses()">ğŸ“¤ ØªØµØ¯ÙŠØ±</button>
          <label class="btn btn-secondary" style="cursor: pointer;">
            ğŸ“¥ Ø§Ø³ØªÙŠØ±Ø§Ø¯
            <input type="file" id="importFile" accept=".json" style="display: none;" onchange="importLicenses(event)">
          </label>
        </div>

        <!-- Revocation URL Section -->
        <div style="background: var(--bg-secondary); border: 1px solid var(--border); border-radius: 8px; padding: 1rem; margin-bottom: 1rem;">
          <label style="display: flex; align-items: center; gap: 0.5rem; margin-bottom: 0.5rem;">
            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="none" viewBox="0 0 24 24" stroke="var(--warning)">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z" />
            </svg>
            Ø±Ø§Ø¨Ø· Ù…Ù„Ù Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ù…Ù„ØºØ§Ø© (Ù„Ù„ØªØ²Ø§Ù…Ù†)
          </label>
          <div style="display: flex; gap: 0.5rem;">
            <input type="text" id="revocationUrl" placeholder="https://gist.githubusercontent.com/..." style="flex: 1; font-size: 0.9rem;" dir="ltr">
            <button class="btn btn-primary" onclick="saveRevocationUrl()" style="padding: 0.5rem 1rem;">ğŸ’¾ Ø­ÙØ¸</button>
          </div>
          <p style="font-size: 0.8rem; color: var(--text-muted); margin-top: 0.5rem;">
            Ø§Ø³ØªØ¶Ù Ù…Ù„Ù revoked-licenses.json Ø¹Ù„Ù‰ GitHub Gist ÙˆØ£Ù„ØµÙ‚ Ø§Ù„Ø±Ø§Ø¨Ø· Ù‡Ù†Ø§
          </p>
          <div style="display: flex; gap: 0.5rem; margin-top: 0.75rem;">
            <button class="btn btn-secondary" onclick="exportRevokedLicenses()" style="flex: 1; font-size: 0.85rem;">
              ğŸ“¥ ØªØµØ¯ÙŠØ± Ø§Ù„Ù…Ù„ØºØ§Ø©
            </button>
            <button class="btn btn-danger" onclick="revokeSelectedLicenses()" style="flex: 1; font-size: 0.85rem;" id="revokeBtn" disabled>
              ğŸš« Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©
            </button>
          </div>
        </div>

        <div class="licenses-list" id="licensesList">
          <div class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <p>Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ±Ø§Ø®ÙŠØµ Ø¨Ø¹Ø¯</p>
            <p style="font-size: 0.9rem;">Ø£Ù†Ø´Ø¦ ØªØ±Ø®ÙŠØµÙƒ Ø§Ù„Ø£ÙˆÙ„ Ù…Ù† Ø§Ù„Ù†Ù…ÙˆØ°Ø¬</p>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Toast -->
  <div class="toast" id="toast"></div>

  <script>
    // License signature system - MUST match the app's licenseSignature.ts
    const SECRET_KEY = 'BHD-LICENSE-SECRET-2024-XK9M';

    function simpleHash(str) {
      let hash = 0;
      for (let i = 0; i < str.length; i++) {
        const char = str.charCodeAt(i);
        hash = ((hash << 5) - hash) + char;
        hash = hash & hash;
      }
      
      let signature = '';
      for (let i = 0; i < 4; i++) {
        let subHash = 0;
        const subStr = str + SECRET_KEY + i.toString();
        for (let j = 0; j < subStr.length; j++) {
          const char = subStr.charCodeAt(j);
          subHash = ((subHash << 5) - subHash) + char;
          subHash = subHash & subHash;
        }
        signature += Math.abs(subHash).toString(16).padStart(8, '0');
      }
      
      return signature.toUpperCase();
    }

    function generateLicenseSignature(data) {
      const payload = `${data.k}|${data.t}|${data.m}|${data.e || 'null'}|${data.c}|${SECRET_KEY}`;
      return simpleHash(payload);
    }

    // License types configuration
    const LICENSE_TYPES = {
      trial: { name: 'ØªØ¬Ø±ÙŠØ¨ÙŠ', days: 7, profiles: 5 },
      basic: { name: 'Ø£Ø³Ø§Ø³ÙŠ', days: 30, profiles: 20 },
      pro: { name: 'Ø§Ø­ØªØ±Ø§ÙÙŠ', days: 365, profiles: 100 },
      enterprise: { name: 'Ù…Ø¤Ø³Ø³ÙŠ', days: 730, profiles: 999 }
    };

    let licenses = [];
    let revokedLicenses = [];
    let selectedLicenses = new Set();
    let lastGeneratedCode = '';

    // Load licenses from localStorage
    function loadLicenses() {
      const saved = localStorage.getItem('profile-suite-licenses');
      if (saved) {
        licenses = JSON.parse(saved);
      }
      const savedRevoked = localStorage.getItem('profile-suite-revoked-licenses');
      if (savedRevoked) {
        revokedLicenses = JSON.parse(savedRevoked);
      }
      const savedUrl = localStorage.getItem('profile-suite-revocation-url');
      if (savedUrl) {
        document.getElementById('revocationUrl').value = savedUrl;
      }
      renderLicenses();
      updateStats();
    }

    // Save licenses to localStorage
    function saveLicenses() {
      localStorage.setItem('profile-suite-licenses', JSON.stringify(licenses));
      updateStats();
    }

    // Save revoked licenses
    function saveRevokedLicenses() {
      localStorage.setItem('profile-suite-revoked-licenses', JSON.stringify(revokedLicenses));
    }

    // Save revocation URL
    function saveRevocationUrl() {
      const url = document.getElementById('revocationUrl').value.trim();
      localStorage.setItem('profile-suite-revocation-url', url);
      showToast('ØªÙ… Ø­ÙØ¸ Ø±Ø§Ø¨Ø· Ø§Ù„ØªØ²Ø§Ù…Ù†', 'success');
    }

    // Export revoked licenses as JSON
    function exportRevokedLicenses() {
      const data = {
        version: 1,
        updatedAt: new Date().toISOString(),
        revokedKeys: revokedLicenses.map(r => r.key)
      };
      const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = 'revoked-licenses.json';
      a.click();
      URL.revokeObjectURL(url);
      showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ù…Ù„ØºØ§Ø© - Ø§Ø±ÙØ¹ Ø§Ù„Ù…Ù„Ù Ø¥Ù„Ù‰ GitHub Gist', 'success');
    }

    // Revoke selected licenses
    function revokeSelectedLicenses() {
      if (selectedLicenses.size === 0) return;
      
      if (!confirm(`Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ ${selectedLicenses.size} ØªØ±Ø®ÙŠØµØŸ`)) return;
      
      selectedLicenses.forEach(id => {
        const license = licenses.find(l => l.id === id);
        if (license && !revokedLicenses.find(r => r.key === license.key)) {
          revokedLicenses.push({
            key: license.key,
            revokedAt: new Date().toISOString(),
            clientName: license.clientName
          });
        }
      });
      
      saveRevokedLicenses();
      selectedLicenses.clear();
      updateRevokeButton();
      renderLicenses();
      showToast('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© - Ù‚Ù… Ø¨ØªØµØ¯ÙŠØ± Ù…Ù„Ù Ø§Ù„Ù…Ù„ØºØ§Ø© ÙˆØ§Ø±ÙØ¹Ù‡', 'success');
    }

    // Toggle license selection
    function toggleLicenseSelection(id) {
      if (selectedLicenses.has(id)) {
        selectedLicenses.delete(id);
      } else {
        selectedLicenses.add(id);
      }
      updateRevokeButton();
      renderLicenses();
    }

    // Update revoke button state
    function updateRevokeButton() {
      const btn = document.getElementById('revokeBtn');
      btn.disabled = selectedLicenses.size === 0;
      btn.textContent = selectedLicenses.size > 0 
        ? `ğŸš« Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø© (${selectedLicenses.size})`
        : 'ğŸš« Ø¥Ù„ØºØ§Ø¡ Ø§Ù„Ù…Ø­Ø¯Ø¯Ø©';
    }

    // Generate random key
    function generateKey() {
      const chars = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789';
      let key = '';
      for (let i = 0; i < 16; i++) {
        if (i > 0 && i % 4 === 0) key += '-';
        key += chars[Math.floor(Math.random() * chars.length)];
      }
      return key;
    }

    // Create license
    document.getElementById('licenseForm').addEventListener('submit', function(e) {
      e.preventDefault();

      const clientName = document.getElementById('clientName').value.trim();
      const clientEmail = document.getElementById('clientEmail').value.trim();
      const licenseType = document.getElementById('licenseType').value;
      const customProfiles = document.getElementById('maxProfiles').value;
      const customDays = document.getElementById('durationDays').value;
      const notes = document.getElementById('notes').value.trim();

      if (!clientName) {
        showToast('ÙŠØ±Ø¬Ù‰ Ø¥Ø¯Ø®Ø§Ù„ Ø§Ø³Ù… Ø§Ù„Ø¹Ù…ÙŠÙ„', 'error');
        return;
      }

      const typeConfig = LICENSE_TYPES[licenseType];
      const maxProfiles = customProfiles ? parseInt(customProfiles) : typeConfig.profiles;
      const days = customDays ? parseInt(customDays) : typeConfig.days;

      const now = new Date();
      const expiration = new Date(now.getTime() + days * 24 * 60 * 60 * 1000);
      const key = generateKey();

      // Create license data for encoding
      const creationTimestamp = now.getTime();
      const licenseDataForSignature = {
        k: key,
        t: licenseType,
        m: maxProfiles,
        e: expiration.toISOString(),
        c: creationTimestamp
      };

      // Generate signature
      const signature = generateLicenseSignature(licenseDataForSignature);

      // Add signature to license data
      const licenseData = {
        k: key,
        t: licenseType,
        m: maxProfiles,
        e: expiration.toISOString(),
        c: creationTimestamp,
        s: signature  // Digital signature to prevent tampering
      };

      const licenseCode = btoa(JSON.stringify(licenseData));
      lastGeneratedCode = licenseCode;

      // Save license record
      const license = {
        id: Date.now().toString(),
        key: key,
        code: licenseCode,
        clientName: clientName,
        clientEmail: clientEmail,
        type: licenseType,
        maxProfiles: maxProfiles,
        days: days,
        notes: notes,
        createdAt: now.toISOString(),
        expiresAt: expiration.toISOString()
      };

      licenses.unshift(license);
      saveLicenses();
      renderLicenses();

      // Show result
      document.getElementById('licenseInfo').innerHTML = `
        <div class="license-info-item">
          <span>Ø§Ù„Ø¹Ù…ÙŠÙ„</span>
          <span>${clientName}</span>
        </div>
        <div class="license-info-item">
          <span>Ø§Ù„Ù†ÙˆØ¹</span>
          <span>${typeConfig.name}</span>
        </div>
        <div class="license-info-item">
          <span>Ø§Ù„Ø¨Ø±ÙˆÙØ§ÙŠÙ„Ø§Øª</span>
          <span>${maxProfiles}</span>
        </div>
        <div class="license-info-item">
          <span>ÙŠÙ†ØªÙ‡ÙŠ ÙÙŠ</span>
          <span>${expiration.toLocaleDateString('ar-SA')}</span>
        </div>
      `;
      document.getElementById('licenseCode').textContent = licenseCode;
      document.getElementById('licenseResult').classList.add('show');

      showToast('ØªÙ… Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„ØªØ±Ø®ÙŠØµ Ø¨Ù†Ø¬Ø§Ø­!', 'success');
    });

    // Copy license code
    function copyLicenseCode() {
      navigator.clipboard.writeText(lastGeneratedCode).then(() => {
        showToast('ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯!', 'success');
      });
    }

    // Reset form
    function resetForm() {
      document.getElementById('licenseForm').reset();
      document.getElementById('licenseResult').classList.remove('show');
    }

    // Render licenses list
    function renderLicenses() {
      const container = document.getElementById('licensesList');
      const searchQuery = document.getElementById('searchLicenses').value.toLowerCase();

      const filtered = licenses.filter(lic => 
        lic.clientName.toLowerCase().includes(searchQuery) ||
        lic.clientEmail.toLowerCase().includes(searchQuery) ||
        lic.key.toLowerCase().includes(searchQuery)
      );

      if (filtered.length === 0) {
        container.innerHTML = `
          <div class="empty-state">
            <svg xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor">
              <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" />
            </svg>
            <p>${searchQuery ? 'Ù„Ø§ ØªÙˆØ¬Ø¯ Ù†ØªØ§Ø¦Ø¬' : 'Ù„Ø§ ØªÙˆØ¬Ø¯ ØªØ±Ø§Ø®ÙŠØµ Ø¨Ø¹Ø¯'}</p>
          </div>
        `;
        return;
      }

      container.innerHTML = filtered.map(lic => {
        const isExpired = new Date() > new Date(lic.expiresAt);
        const isRevoked = revokedLicenses.some(r => r.key === lic.key);
        const isSelected = selectedLicenses.has(lic.id);
        const typeConfig = LICENSE_TYPES[lic.type];
        const expiresDate = new Date(lic.expiresAt).toLocaleDateString('ar-SA');
        
        let statusBadge = '';
        if (isRevoked) {
          statusBadge = '<span class="badge" style="background: var(--danger); color: #fff;">Ù…Ù„ØºÙŠ</span>';
        } else if (isExpired) {
          statusBadge = '<span class="badge badge-expired">Ù…Ù†ØªÙ‡ÙŠ</span>';
        } else {
          statusBadge = '<span class="badge badge-active">ÙØ¹Ø§Ù„</span>';
        }
        
        return `
          <div class="license-item" style="${isSelected ? 'border-color: var(--primary); background: rgba(99, 102, 241, 0.1);' : ''} ${isRevoked ? 'opacity: 0.6;' : ''}">
            <div class="license-item-header">
              <label style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer;">
                <input type="checkbox" ${isSelected ? 'checked' : ''} ${isRevoked ? 'disabled' : ''} onchange="toggleLicenseSelection('${lic.id}')" style="width: 18px; height: 18px; cursor: pointer;">
                <span class="license-item-name">${lic.clientName}</span>
              </label>
              <span class="license-item-type type-${lic.type}">${typeConfig.name}</span>
            </div>
            <div class="license-item-details">
              ${statusBadge}
              &nbsp;â€¢&nbsp;
              ${lic.maxProfiles} Ø¨Ø±ÙˆÙØ§ÙŠÙ„
              &nbsp;â€¢&nbsp;
              ÙŠÙ†ØªÙ‡ÙŠ: ${expiresDate}
              ${lic.clientEmail ? `&nbsp;â€¢&nbsp; ${lic.clientEmail}` : ''}
            </div>
            <div class="license-item-actions">
              <button class="btn btn-secondary" onclick="copyCode('${lic.id}')">ğŸ“‹ Ù†Ø³Ø®</button>
              ${!isRevoked ? `<button class="btn btn-secondary" style="background: var(--warning); color: #000;" onclick="revokeSingleLicense('${lic.id}')">ğŸš« Ø¥Ù„ØºØ§Ø¡</button>` : ''}
              <button class="btn btn-danger" onclick="deleteLicense('${lic.id}')">ğŸ—‘ï¸ Ø­Ø°Ù</button>
            </div>
          </div>
        `;
      }).join('');
    }

    // Revoke single license
    function revokeSingleLicense(id) {
      if (!confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø¥Ù„ØºØ§Ø¡ Ù‡Ø°Ø§ Ø§Ù„ØªØ±Ø®ÙŠØµØŸ Ù„Ù† ÙŠØ¹Ù…Ù„ ÙÙŠ Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ Ø¨Ø¹Ø¯ Ø§Ù„ØªØ²Ø§Ù…Ù†.')) return;
      
      const license = licenses.find(l => l.id === id);
      if (license && !revokedLicenses.find(r => r.key === license.key)) {
        revokedLicenses.push({
          key: license.key,
          revokedAt: new Date().toISOString(),
          clientName: license.clientName
        });
        saveRevokedLicenses();
        renderLicenses();
        showToast('ØªÙ… Ø¥Ù„ØºØ§Ø¡ Ø§Ù„ØªØ±Ø®ÙŠØµ - Ù‚Ù… Ø¨ØªØµØ¯ÙŠØ± Ù…Ù„Ù Ø§Ù„Ù…Ù„ØºØ§Ø© ÙˆØ§Ø±ÙØ¹Ù‡', 'success');
      }
    }

    // Copy specific license code
    function copyCode(id) {
      const license = licenses.find(l => l.id === id);
      if (license) {
        navigator.clipboard.writeText(license.code).then(() => {
          showToast('ØªÙ… Ù†Ø³Ø® Ø§Ù„ÙƒÙˆØ¯!', 'success');
        });
      }
    }

    // Delete license
    function deleteLicense(id) {
      if (confirm('Ù‡Ù„ ØªØ±ÙŠØ¯ Ø­Ø°Ù Ù‡Ø°Ø§ Ø§Ù„ØªØ±Ø®ÙŠØµØŸ')) {
        licenses = licenses.filter(l => l.id !== id);
        saveLicenses();
        renderLicenses();
        showToast('ØªÙ… Ø­Ø°Ù Ø§Ù„ØªØ±Ø®ÙŠØµ', 'success');
      }
    }

    // Export licenses
    function exportLicenses() {
      const data = JSON.stringify(licenses, null, 2);
      const blob = new Blob([data], { type: 'application/json' });
      const url = URL.createObjectURL(blob);
      const a = document.createElement('a');
      a.href = url;
      a.download = `licenses-${new Date().toISOString().split('T')[0]}.json`;
      a.click();
      URL.revokeObjectURL(url);
      showToast('ØªÙ… ØªØµØ¯ÙŠØ± Ø§Ù„ØªØ±Ø§Ø®ÙŠØµ', 'success');
    }

    // Import licenses
    function importLicenses(event) {
      const file = event.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function(e) {
        try {
          const imported = JSON.parse(e.target.result);
          if (Array.isArray(imported)) {
            licenses = [...imported, ...licenses];
            saveLicenses();
            renderLicenses();
            showToast(`ØªÙ… Ø§Ø³ØªÙŠØ±Ø§Ø¯ ${imported.length} ØªØ±Ø®ÙŠØµ`, 'success');
          }
        } catch (err) {
          showToast('Ø®Ø·Ø£ ÙÙŠ Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…Ù„Ù', 'error');
        }
      };
      reader.readAsText(file);
      event.target.value = '';
    }

    // Update stats
    function updateStats() {
      const now = new Date();
      const today = now.toDateString();
      
      const active = licenses.filter(l => new Date(l.expiresAt) > now).length;
      const expired = licenses.length - active;
      const todayCount = licenses.filter(l => new Date(l.createdAt).toDateString() === today).length;

      document.getElementById('totalLicenses').textContent = licenses.length;
      document.getElementById('activeLicenses').textContent = active;
      document.getElementById('expiredLicenses').textContent = expired;
      document.getElementById('todayLicenses').textContent = todayCount;
    }

    // Search handler
    document.getElementById('searchLicenses').addEventListener('input', renderLicenses);

    // Update defaults based on license type
    document.getElementById('licenseType').addEventListener('change', function() {
      const type = this.value;
      const config = LICENSE_TYPES[type];
      document.getElementById('maxProfiles').placeholder = `Ø§ÙØªØ±Ø§Ø¶ÙŠ: ${config.profiles}`;
      document.getElementById('durationDays').placeholder = `Ø§ÙØªØ±Ø§Ø¶ÙŠ: ${config.days} ÙŠÙˆÙ…`;
    });

    // Show toast notification
    function showToast(message, type = 'success') {
      const toast = document.getElementById('toast');
      toast.textContent = message;
      toast.className = 'toast ' + type + ' show';
      setTimeout(() => {
        toast.classList.remove('show');
      }, 3000);
    }

    // Initialize
    loadLicenses();
  </script>
</body>
</html>
